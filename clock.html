<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Bing背景时钟</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      height: 100vh;
      background-color: #2c3e50;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: "Helvetica Neue", sans-serif;
      color: white;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
      overflow: hidden;
    }

    .container {
      text-align: center;
      background-color: rgba(0, 0, 0, 0.4);
      padding: 15px 20px;
      border-radius: 12px;
      max-width: 90%;
    }

    .time {
      font-size: 3rem;
      font-weight: bold;
      margin-bottom: 8px;
    }

    .date {
      font-size: 1.6rem;
      margin-bottom: 12px;
    }

    .hitokoto {
      font-size: 1rem;
      margin: 10px 0;
      font-style: italic;
      min-height: 2.2em;
      line-height: 1.3;
    }

    .bing-copyright {
      font-size: 0.8rem;
      margin-top: 12px;
      font-style: italic;
      opacity: 0.9;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="time" id="time">00:00</div>
    <div class="date" id="date">2023年1月1日 星期日</div>
    <div class="hitokoto" id="hitokoto">加载中...</div>
    <div class="bing-copyright" id="bingCopyright">电子墨水屏时钟</div>
  </div>

  <script>
    // 兼容性补丁：padStart 模拟
    function pad(num) {
      return num < 10 ? '0' + num : num;
    }

    // 更新时间（每分钟更新）
    function updateTime() {
      var now = new Date();
      var hours = now.getHours();
      var minutes = now.getMinutes();
      var timeString = pad(hours) + ':' + pad(minutes);

      var year = now.getFullYear();
      var month = now.getMonth() + 1;
      var day = now.getDate();
      var weekdays = ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'];
      var weekday = weekdays[now.getDay()];
      var dateString = year + '年' + month + '月' + day + '日 ' + weekday;

      document.getElementById('time').textContent = timeString;
      document.getElementById('date').textContent = dateString;
    }

    // 获取 Bing 背景图（使用 JSONP 绕过 CORS，兼容老浏览器）
    function getBingImage() {
      var script = document.createElement('script');
      script.src = 'https://www.bing.com/HPImageArchive.aspx?format=js&idx=0&n=1&mkt=zh-CN&callback=bingCallback';
      script.onerror = function() {
        fallbackBackground();
      };
      document.head.appendChild(script);
    }

    // Bing 回调函数
    window.bingCallback = function(data) {
      if (data && data.images && data.images.length > 0) {
        var imageUrl = 'https://www.bing.com' + data.images[0].url.split('&')[0]; // 去掉参数，避免大图
        var copyright = data.images[0].copyright || 'Bing 壁纸';
        document.body.style.backgroundImage = 'url(' + imageUrl + ')';
        document.getElementById('bingCopyright').textContent = copyright;
      } else {
        document.getElementById('bingCopyright').textContent = '今日壁纸加载失败';
      }
    };

    // 获取一言（使用 script 标签 JSONP 风格）
    function getHitokoto() {
      var script = document.createElement('script');
      var categories = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l'];
      var randomCategory = categories[Math.floor(Math.random() * categories.length)];
      script.src = 'https://v1.hitokoto.cn/?c=' + randomCategory + '&encode=json&callback=hitokotoCallback';
      script.onerror = function() {
        document.getElementById('hitokoto').textContent = '一言加载失败';
      };
      document.head.appendChild(script);
    }

    // 一言回调
    window.hitokotoCallback = function(data) {
      var text = data.hitokoto;
      if (data.from_who && data.from) {
        text += ' —— ' + data.from_who + '《' + data.from + '》';
      } else if (data.from) {
        text += ' —— 《' + data.from + '》';
      }
      document.getElementById('hitokoto').textContent = text;
    };

    // 降级背景
    function fallbackBackground() {
      document.body.style.backgroundColor = '#34495e';
      document.body.style.backgroundImage = '';
    }

    // 初始化
    updateTime();
    getBingImage();
    getHitokoto();

    // 定时任务
    setInterval(updateTime, 60000);           // 每分钟更新时间
    setInterval(getHitokoto, 3600000);        // 每小时换一句一言
  </script>
</body>
</html>
